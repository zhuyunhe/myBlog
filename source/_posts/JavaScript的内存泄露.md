---
title: JavaScript的内存泄露
date: 2016-05-27 23:59:23
tags:

- 学习
- JavaScript

categories: 学习笔记
---
# 什么是内存泄露
本质上，内存泄露可以定义为：应用程序不再需要占用内存的时候，由于某些原因，内存没有被操作系统或可用内存池回收。编程语言管理内存的方式各不相同，一些语言提供了语言特性，可以帮助开发者做此类事情；另一些则寄希望于开发者对内存是否需要回收清晰明了。
# JavaScript内存管理
JavaScript是一种垃圾回收语言。垃圾回收语言通过周期性地检查先前分配的内存是否可达，帮助开发者管理内存。换言之，垃圾回收语言减轻了“内存仍可用”及“内存仍可达”的问题。这二者的关系是微妙但重要的：仅有开发者了解哪些内存是将来仍然要使用的；而哪些内存是可达或者不可达则可以由算法确定和标记，不可达的内存适时被操作系统回收。
# JavaScript内存泄露
垃圾回收语言的内存泄露主因是“不需要的引用”。
# 标记清除(Mark-and-Sweep)
大部分自动垃圾回收语言用的算法是基于标记清除算法，算法由以下几步组成：

- 垃圾回收器创建一个“roots”列表。root通常是代码中全局变量的引用。JavaScript中，“window”对象是一个全局变量，被当做root。window对象总是存在的，因此垃圾回收器可以检查它和它的所有子对象是否存在（即不是垃圾对象）。
- 所有的roots被检查和标记为激活（即不是垃圾）。roots对象的所有子对象也被递归地检查。从root开始的所有对象如果是可达的，它就不被当做垃圾。
- 所有未被标记的内存会被当做垃圾，收集器现在可以释放这部分垃圾内存，把它们归还给操作系统了。   

现代的垃圾回收器改良了算法，但是本质是相同的：可达内存被标记，其余的被当作垃圾回收。
在内存泄露中提到的“不需要的引用”指的就是开发者明知这些内存引用不再需要，却由于某些原因，它仍被留在激活的root树中。在JavaScript中，不需要的引用是某些保留在代码中的变量，它们不再被需要，却指向了一块本该被释放的内存。有些人认为这是开发者的错误。  
为了理解JavaScript中最常见的内存泄露，我们需要了解哪种方式的引用容易被遗忘。
# 三种常见的JavaScript内存泄露
JavaScript中对未定义变量的处理方式比较宽松：在非严格模式中，未定义的变量会在全局对象创建一个新变量，在浏览器中，全局对象是window。
http://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&mid=2651220885&idx=1&sn=0a313ecc854527dc5007acba5fde976c&scene=23&srcid=0527T5LD3Z5sN0TKLy5NGW3R#rd